{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load static %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
<link rel="stylesheet" href="{% static 'css/style.css' %}">
{% block body %}

    <div class="row">
        <div class="col-12 border d-flex justify-content-between rounded-4">
            <div class="rounded-circle ms-3 col-2 border border-light border-2 border-opacity-25 d-flex justify-content-center flex-column">
                <img class="rounded-circle" src="{{ user.image.url }}" style="width:100%; height:100%;" alt="">
            </div>
            <div class="ms-5 col-7 text-start border border-light border-2 border-opacity-25 rounded-5">
                <div>
                    <h3> {{ user.username }} 
                        <span>
                            <a class="btn btn-sm btn-outline-info" href="{% url 'accounts:update' user.pk %}">프로필수정
                            </a>
                    </span>
                    <span>
                        <a class="btn btn-sm btn-outline-info" href="{% url 'accounts:delete' user.pk %}"><i class="bi bi-gear-wide"></i></a>
                    </span>
                    </h3>             
                </div>
                <p>{{ user.email }}</p>
                <p>{{ user.content }}</p>
                {% if request.user != user %}
                    <form id='follow-form' data-user-id="{{ user.pk }}">
                    {% csrf_token %}
                    {% if request.user in user.followers.all %}
                    <button type='submit' class='btn btn-sm btn-outline-info rounded-pill' id='follow-btn'>언팔로우</button>
                    {% else %}
                    <button type='submit' class='btn btn-sm btn-outline-info rounded-pill' id='follow-btn'>팔로우</button>
                    {% endif %}
                    </form>
                    {% endif %}
            </div>
        </div>
    </div>
<div class="container">
    <div class="row">
        <div class="col-12 border border-success my-3" style="padding: 200px;">
        </div>
    </div>
</div>

{% endblock body %}

{% block script %}
  <script>
    const followForm = document.querySelector('#follow-form')
    if (followForm) {
      const csrftoken = document
        .querySelector('[name=csrfmiddlewaretoken]')
        .value
        followForm
        .addEventListener('submit', function (event) {
          axios({
            method: 'post',
            url: `/accounts/${event.target.dataset.userId}/follow/`,
            headers: {
              'X-CSRFToken': csrftoken
            }
          }).then((response) => {
            const followBtn = document.querySelector('#follow-btn')
            if (response.data.is_followed === true) {
              followBtn.innerText = '언팔로우'
            } else {
              followBtn.innerText = '팔로우'
            }
          })
        })
    }
  </script>
{% endblock script %}
