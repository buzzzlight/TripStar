{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load static %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
<link rel="stylesheet" href="{% static 'css/style.css' %}">

{% block body %}
    <div class="container">
    <div class="row">
        <div class="col-12 d-flex justify-content-around py-5" style="height:270px;">
            <div class="rounded-circle col-2 border border-4 border-opacity-25" style="width: 200px; height: 200px;">
            {% if user.image %}
                <img class="rounded-circle w-100 h-100" src="{{ user.image.url }}" alt="">
            {% else %}
                <img class="rounded-circle w-100 h-100" src="https://icon-library.com/images/no-image-icon/no-image-icon-0.jpg" alt="">
            {% endif %}
            </div>
            <div class="col-7 gx-1 text-start">
                    <h5 class="d-flex mt-2 mx-2"><b> {{ user.username }} </b>
                    {% if request.user == user %}
                    <span>
                        <a class="ms-3 text-muted" data-bs-toggle="modal" data-bs-target="#exampleModal"><i class="bi bi-gear-wide"></i></a>
                    </span>
                    {% else %}
                    <span><form class="d-flex ms-3" id='follow-form' data-user-id="{{ user.pk }}">
                    {% csrf_token %}
                    {% if request.user in user.followers.all %}
                    <button type='submit' class='btn btn-sm btn-outline-info rounded-pill' id='follow-btn'>언팔로우</button>
                    {% else %}
                    <button type='submit' class='btn btn-sm btn-outline-info rounded-pill' id='follow-btn'>팔로우</button>
                    {% endif %}
                    </form>
                    </span>
                    <a href="{% url 'accounts:block' user.pk %}">
                        {% if request.user in user.blockers.all %}
                        <button type='submit' class='btn btn-sm btn-outline-danger rounded-pill' style="margin-left:0.8rem;">차단 취소</button>
                        {% else %}
                        <button type='submit' class='btn btn-sm btn-outline-danger rounded-pill' style="margin-left:0.8rem;">차단</button>
                    </a>
                        {% endif %}
                    {% endif %}
                    </h5>             
                    <br>
                <div class="mx-2">
                    <span class=""><b>게시물수</b></span>
                    <span class="ms-1"><a href=""></a>{{ review.count }}</span>
                    <span class="ms-2"><b>팔로워</b></span>
                    <span class="ms-1"><a href=""></a>{{ user.followers.count }}</span>
                    <span class="ms-2"><b>팔로잉</b></span>
                    <span class="ms-1"><a href=""></a>{{ user.following.all|length }}</span>
                </div>
                <br>
                <div>
                    <p class="mx-2">{{ user.content }}</p>
                </div>
            </div>
        
        </div>
        <div class="col about text-center mb-0">
            <span class="nick_name"><i class="bi bi-grid-3x3-gap"></i> 작성 리뷰 </span>
            <span class="book_mark"><i class="bi bi-heart-fill"></i> 위시리스트 </span>
            <hr>
        </div>
    </div>


        <div class="mylist_contents contents_container active mt-3">
            <div class="pic">
                <a href="#"><img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"><img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"> <img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"> <img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"> <img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"> <img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"> <img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"> <img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"> <img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"> <img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"> <img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"> <img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
        </div>


        <div class="bookmark_contents contents_container mt-3">
            <div class="pic">
                <a href="#"><img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"><img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"> <img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"> <img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"> <img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"> <img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"> <img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"> <img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
            <div class="pic">
                <a href="#"> <img src="https://dummyimage.com/300x200/000/fff" alt=""></a>
            </div>
        </div>
    </section>
</div>
</div>
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">프로필 수정</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <a href="{% url 'accounts:update' user.pk %}">
                    <div class="card text-center">
                        <div class="card-body">
                            프로필 수정
                        </div>
                    </div>
                </a>
                <a href="{% url 'accounts:password' %}">
                  <div class="card text-center">
                    <div class="card-body">
                      비밀번호 변경
                    </div>
                  </div>
                </a>
                <a href="{% url 'accounts:delete' user.pk %}">
                <div class="card text-center">
                    <div class="card-body">
                        회원탈퇴
                    </div>
                </div>
                </a>
                <a href="{% url 'accounts:block_user' %}">
                <div class="card text-center">
                    <div class="card-body" style="color:red;">
                        차단목록
                    </div>
                </div>
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock body %}

{% block script %}
  <script>
    const followForm = document.querySelector('#follow-form')
    if (followForm) {
      const csrftoken = document
        .querySelector('[name=csrfmiddlewaretoken]')
        .value
        followForm
        .addEventListener('submit', function (event) {
          axios({
            method: 'post',
            url: `/accounts/${event.target.dataset.userId}/follow/`,
            headers: {
              'X-CSRFToken': csrftoken
            }
          }).then((response) => {
            const followBtn = document.querySelector('#follow-btn')
            if (response.data.is_followed === true) {
              followBtn.innerText = '언팔로우'
            } else {
              followBtn.innerText = '팔로우'
            }
          })
        })
    }
  </script>
  <script>
    $('#openCloseDiv').click(function () {

        if ($('#noneDiv').css("display") == "none") {

          $(".button-toggle").click(function (event) {
            x = $(this).attr("href");
            $("html, body")
              .stop()
              .animate({
                scrollTop: $(x)
                  .offset()
                  .top = 10
              }, 1000, "easeInOutExpo");
          });

          $('#noneDiv').show();

        } else {
          $('#noneDiv').hide();
        }
      });
  </script>
  <script>
const tapContainer = document.querySelector('.about');
const flex_Container = document.querySelectorAll('.contents_container');
const taps = document.querySelectorAll('.about > span');


function openCity(e){
    let elem = e.target;
    
    for (var i = 0; i < flex_Container.length; i++) {
        flex_Container[i].classList.remove('active');
        taps[i].classList.remove('on');
    }
    
    if(elem.matches('[class="nick_name"]')){
        
        flex_Container[0].classList.add('active');
        taps[0].classList.add('on');
        
    }else if(elem.matches('[class="book_mark"]')){
        
        flex_Container[1].classList.add('active');
        taps[1].classList.add('on');
        
    }
    
}

tapContainer.addEventListener('click', openCity);
  </script>
{% endblock script %}
